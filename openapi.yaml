openapi: 3.0.3
info:
  title: Corruption Tracker API
  version: 1.0.0
  description: |
    Backend API for the Corruption Tracker platform - a crowdsourcing platform dedicated to exposing corruption in India.
    
    **Features:**
    - Anonymous corruption reporting
    - Real-time statistics and analytics
    - State-wise heatmap visualization
    - Advanced filtering with pagination
    
  contact:
    name: API Support
    url: https://corrupt.fyi
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: http://localhost:3000
    description: Local development server
  - url: https://api.corrupt.fyi
    description: Production server

tags:
  - name: Health
    description: Health check endpoints
  - name: Reports
    description: Corruption report submission and retrieval
  - name: Statistics
    description: Aggregated statistics and analytics
  - name: States
    description: Metadata about Indian states

paths:
  /health:
    get:
      tags:
        - Health
      summary: Health check
      description: Returns the health status of the API service
      operationId: getHealth
      responses:
        '200':
          description: Service is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: ok
                  timestamp:
                    type: string
                    format: date-time
                    example: '2026-01-07T02:00:00.000Z'
                  service:
                    type: string
                    example: corruption-tracker-api

  /api/v1/states:
    get:
      tags:
        - States
      summary: Get list of states
      description: Returns a list of all valid Indian states and Union Territories with their abbreviations.
      operationId: getStates
      responses:
        '200':
          description: Successful response with list of states
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/StateEntry'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/v1/states/{code}/districts:
    get:
      tags:
        - States
      summary: Get districts for a state
      description: Returns a list of districts for a specific Indian state.
      operationId: getDistricts
      parameters:
        - name: code
          in: path
          description: 2-letter state abbreviation (e.g., AP, TN)
          required: true
          schema:
            type: string
            minLength: 2
            maxLength: 2
            pattern: '^[A-Za-z]{2}$'
            example: TN
      responses:
        '200':
          description: Successful response with list of districts
          content:
            application/json:
              schema:
                type: array
                items:
                  type: string
                  example: Chennai
        '404':
          description: State not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/v1/reports/all:
    get:
      tags:
        - Reports
      summary: Get all reports
      description: |
        Retrieve all corruption reports without pagination.
        **Warning:** This returns all records and may be slow for large datasets.
      operationId: getAllReports
      responses:
        '200':
          description: Successful response with all reports
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Report'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    delete:
      tags:
        - Reports
      summary: Delete all reports
      description: |
        Delete all corruption reports from the database.
        **Warning:** This action is irreversible.
      operationId: deleteAllReports
      responses:
        '204':
          description: All reports deleted successfully
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/v1/reports:
    get:
      tags:
        - Reports
      summary: List corruption reports
      description: Retrieve a paginated list of corruption reports with optional filtering by state and department
      operationId: getReports
      parameters:
        - name: state
          in: query
          description: Filter by Indian state abbreviation (e.g., AP, TN, MH)
          required: false
          schema:
            type: string
            minLength: 2
            maxLength: 2
            pattern: '^[A-Z]{2}$'
            example: TN
        - name: department
          in: query
          description: Filter by department name
          required: false
          schema:
            type: string
            example: Police
        - name: limit
          in: query
          description: Maximum number of results to return
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
            example: 20
        - name: offset
          in: query
          description: Number of results to skip for pagination
          required: false
          schema:
            type: integer
            minimum: 0
            default: 0
            example: 0
      responses:
        '200':
          description: Successful response with paginated reports
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ReportListResponse'
        '400':
          description: Invalid query parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationError'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    post:
      tags:
        - Reports
      summary: Submit a corruption report
      description: |
        Submit a new anonymous corruption report. 
        
        **Rate Limiting:** 10 requests per 15 minutes per IP address
      operationId: createReport
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/NewReportInput'
      responses:
        '201':
          description: Report created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Report'
        '400':
          description: Validation failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationError'
        '429':
          description: Too many requests - rate limit exceeded
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/v1/stats/summary:
    get:
      tags:
        - Statistics
      summary: Get summary statistics
      description: Returns aggregated summary statistics including total corruption amount, median bribe, and most reported department
      operationId: getSummaryStats
      responses:
        '200':
          description: Successful response with summary statistics
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SummaryStats'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/v1/stats/heatmap:
    get:
      tags:
        - Statistics
      summary: Get heatmap data
      description: |
        Returns state-wise corruption scores for geographic visualization on a heatmap.
        
        **Corruption Score Calculation:**
        - 70% weight: Total bribe amount relative to highest state
        - 30% weight: Report count relative to highest state
        - Range: 0-100 (100 = most corrupt)
      operationId: getHeatmapData
      responses:
        '200':
          description: Successful response with heatmap data
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/HeatmapEntry'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/v1/stats/state/{code}/summary:
    get:
      tags:
        - Statistics
      summary: Get summary statistics for a specific state
      description: Returns aggregated summary statistics for a specific state including total reports, total amount, average bribe, and corruption by department
      operationId: getStateSummary
      parameters:
        - in: path
          name: code
          schema:
            type: string
            minLength: 2
            maxLength: 2
            pattern: '^[A-Za-z]{2}$'
            example: TN
          required: true
          description: Two-letter state code
      responses:
        '200':
          description: Successful response with state summary statistics
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StateSummaryStats'
        '400':
          description: Invalid state code
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

components:
  schemas:
    Report:
      type: object
      required:
        - id
        - department
        - amount
        - state
        - description
        - date_reported
      properties:
        id:
          type: string
          format: uuid
          description: Unique identifier (UUID)
          example: 123e4567-e89b-12d3-a456-426614174000
        department:
          type: string
          description: Government department or agency
          minLength: 1
          maxLength: 200
          example: Police
        amount:
          type: number
          format: float
          description: Bribe amount in Indian Rupees (INR)
          minimum: 0
          example: 5000.00
        state:
          type: string
          description: Indian state abbreviation (2-letter code)
          minLength: 2
          maxLength: 2
          pattern: '^[A-Z]{2}$'
          example: TN
        district:
          type: string
          description: District name
          maxLength: 100
          nullable: true
          example: Chennai
        city:
          type: string
          description: City name
          maxLength: 100
          nullable: true
          example: Chennai
        description:
          type: string
          description: Detailed description of the corruption incident
          minLength: 10
          maxLength: 5000
          example: Traffic police demanded bribe to avoid challan
        date_reported:
          type: string
          format: date-time
          description: Timestamp when the report was submitted
          example: '2026-01-07T02:13:59.716Z'

    NewReportInput:
      type: object
      required:
        - department
        - amount
        - state
        - description
      properties:
        department:
          type: string
          description: Government department or agency
          minLength: 1
          maxLength: 200
          example: Police
        amount:
          type: number
          format: float
          description: Bribe amount in Indian Rupees (INR)
          minimum: 0.01
          maximum: 100000000
          example: 5000
        state:
          type: string
          description: |
            Indian state abbreviation (2-letter code). Case-insensitive, will be converted to uppercase.
            
            **Valid codes:**
            AP (Andhra Pradesh), AR (Arunachal Pradesh), AS (Assam), BR (Bihar), CG (Chhattisgarh),
            GA (Goa), GJ (Gujarat), HR (Haryana), HP (Himachal Pradesh), JH (Jharkhand),
            KA (Karnataka), KL (Kerala), MP (Madhya Pradesh), MH (Maharashtra), MN (Manipur),
            ML (Meghalaya), MZ (Mizoram), NL (Nagaland), OD (Odisha), PB (Punjab),
            RJ (Rajasthan), SK (Sikkim), TN (Tamil Nadu), TS (Telangana), TR (Tripura),
            UP (Uttar Pradesh), UK (Uttarakhand), WB (West Bengal),
            AN (Andaman & Nicobar), CH (Chandigarh), DH (Dadra & Nagar Haveli and Daman & Diu),
            DL (Delhi), JK (Jammu & Kashmir), LA (Ladakh), LD (Lakshadweep), PY (Puducherry)
          minLength: 2
          maxLength: 2
          pattern: '^[A-Za-z]{2}$'
          example: TN
        district:
          type: string
          description: District name (optional)
          maxLength: 100
          nullable: true
          example: Chennai
        city:
          type: string
          description: City name (optional)
          maxLength: 100
          nullable: true
          example: Chennai
        description:
          type: string
          description: Detailed description of the corruption incident
          minLength: 10
          maxLength: 5000
          example: Traffic police demanded bribe to avoid traffic challan for a minor parking violation

    ReportListResponse:
      type: object
      required:
        - data
        - total
      properties:
        data:
          type: array
          description: Array of corruption reports
          items:
            $ref: '#/components/schemas/Report'
        total:
          type: integer
          description: Total number of reports matching the filter criteria
          minimum: 0
          example: 342

    SummaryStats:
      type: object
      required:
        - total_corruption_amount
        - median_bribe
        - most_reported_department
        - total_reports
      properties:
        total_corruption_amount:
          type: number
          format: float
          description: Total sum of all reported bribes in INR
          example: 15000000.50
        median_bribe:
          type: number
          format: float
          description: Median bribe amount across all reports
          example: 5000.00
        most_reported_department:
          type: string
          description: Department with the highest number of reports
          example: Police
        total_reports:
          type: integer
          description: Total number of corruption reports
          minimum: 0
          example: 1234

    HeatmapEntry:
      type: object
      required:
        - state_name
        - total_amount
        - report_count
      properties:
        state_name:
          type: string
          description: Indian state abbreviation
          example: MH
        total_amount:
          type: number
          format: float
          description: Total bribe amount in INR
          minimum: 0
          example: 150000.50
        report_count:
          type: integer
          description: Number of reports from this state
          minimum: 0
          example: 342

    ValidationError:
      type: object
      required:
        - error
        - details
      properties:
        error:
          type: string
          example: Validation failed
        details:
          type: array
          items:
            type: object
            required:
              - field
              - message
            properties:
              field:
                type: string
                description: Field that failed validation
                example: state
              message:
                type: string
                description: Validation error message
                example: Invalid state abbreviation. Must be a valid Indian state code (e.g., AP, TN, MH)

    Error:
      type: object
      required:
        - error
        - message
      properties:
        error:
          type: string
          description: Error type
          example: Internal Server Error
        message:
          type: string
          description: Error message
          example: An unexpected error occurred

    StateSummaryStats:
      type: object
      required:
        - total_reports
        - total_amount
        - avg_bribe
        - corruption_by_departments
      properties:
        total_reports:
          type: integer
          description: Total number of reports
          example: 150
        total_amount:
          type: number
          format: float
          description: Total bribe amount in INR
          example: 500000.00
        avg_bribe:
          type: number
          format: float
          description: Average bribe amount
          example: 3333.33
        corruption_by_departments:
          type: object
          additionalProperties:
            type: integer
          description: Map of department names to report counts
          example:
            Police: 10
            Electricity: 5

  securitySchemes:
    rateLimit:
      type: apiKey
      in: header
      name: X-RateLimit
      description: |
        Rate limiting is applied to protect the API:
        - General API: 100 requests per minute per IP
        - Report submission: 10 requests per 15 minutes per IP

security:
  - rateLimit: []
